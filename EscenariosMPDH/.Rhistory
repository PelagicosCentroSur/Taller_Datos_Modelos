r2.2  <-ggplot(RESIDUOS, aes(Pred,Res,color=variable)) +
geom_smooth(aes(fill=variable,color=variable),alpha=.1)+
geom_point(size = 1.5) +
geom_hline(yintercept = 0) +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Predicho (log)', y = 'Residuales') +
theme_bw(base_size=9.5)
r4.4 <- ggplot(RESIDUOS, aes(sample = Res,color=variable)) +
stat_qq() +
stat_qq_line() +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Sample Quantiles', y ='Theoretical') +
theme_bw(base_size=9.5)
#-------------------------------------------------------------
ggarrange(r1.1,r2.2,r4.4,ncol=3,common.legend = T)
#-------------------------------------------------------------
paste("PerfilVeroS",i,sep="")
dir.esc
# `Fn_Verosimilitud.R`
source(here(dir.fun,"Fn_Verosimilitud.R"))
logRo    <- 11.6
factor    <- seq(0.2,2,0.08)
priorRo  <- log(exp(logRo)*factor)
for(i in 1:nesc){
NombrecarpetaEscV<-paste("PerfilVeroS",i,sep="")
dir.escV <- here(NombrecarpetaEscV)
Verosimilitud(paste("MAE323m",i,sep=""),
dir.esc,
dir.escV,
paste("/PerfilVeroS",i,sep=""),
logRo,
priorRo,
l_log_Ro=281,
l_opt_Ro=322,
l_Fase_desRt=330,
system="mac")
}
i=1
NombrecarpetaEscV<-paste("PerfilVeroS",i,sep="")
NombrecarpetaEscV
dir.escV <- here(NombrecarpetaEscV)
dir.escV
Verosimilitud(paste("MAE323m",i,sep=""),
dir.esc,
dir.escV,
paste("/PerfilVeroS",i,sep=""),
logRo,
priorRo,
l_log_Ro=281,
l_opt_Ro=322,
l_Fase_desRt=330,
system="mac")
# `Fn_Verosimilitud.R`
NombrecarpetaEsc<-"Sensibilidad_mpdh2023"
# 2. Crear un nuevo directorio  donde se encuentran los an치lisis de sensibilidad
dir.esc <- here(NombrecarpetaEsc)
Verosimilitud(paste("MAE323m",i,sep=""),
dir.esc,
dir.escV,
paste("/PerfilVeroS",i,sep=""),
logRo,
priorRo,
l_log_Ro=281,
l_opt_Ro=322,
l_Fase_desRt=330,
system="mac")
paste("/PerfilVeroS",i,sep="")
source(here(dir.fun,"Fn_Verosimilitud.R"))
paste("MAE323m",i,sep="")
dir.esc
dir(dir.esc)
source(here(dir.fun,"Fn_Verosimilitud.R"))
logRo    <- 11.6
factor    <- seq(0.2,2,0.08)
priorRo  <- log(exp(logRo)*factor)
i=1
Verosimilitud(paste("MAE323m",i,sep=""),
dir.0,
dir.esc,
paste("/PerfilVeroS",i,sep=""),
logRo,
priorRo,
l_log_Ro=281,
l_opt_Ro=322,
l_Fase_desRt=330,
system="mac")
source(here(dir.fun,"Fn_Verosimilitud.R"))
logRo    <- 11.6
factor    <- seq(0.2,2,0.08)
priorRo  <- log(exp(logRo)*factor)
for(i in 1:nesc){
Verosimilitud(paste("MAE323m",i,sep=""),
dir.0,
dir.esc,
paste("/PerfilVeroS",i,sep=""),
logRo,
priorRo,
l_log_Ro=281,
l_opt_Ro=322,
l_Fase_desRt=330,
system="mac")
}
## `Rdata_perfil` genera Rdata para perfil de verosimilitud
for(i in 1:nesc){
source(here(dir.fun,"Fn_CrearRdata.R"))
dirperfil<-here(dir.0,paste("PerfilVeroS",i,sep=""))
dfperfil<-Rdata_perfil(dirperfil,admb=paste("/MAE323m",i,sep=""),dir.Rdata,paste("Hito 2s",i,sep=""))}
here(dir.0,paste("PerfilVeroS",i,sep=""))
paste("/MAE323m",i,sep="")
dir.Rdata<-here("Rdata")
## `Rdata_perfil` genera Rdata para perfil de verosimilitud
for(i in 1:nesc){
source(here(dir.fun,"Fn_CrearRdata.R"))
dirperfil<-here(dir.0,paste("PerfilVeroS",i,sep=""))
dfperfil<-Rdata_perfil(dirperfil,admb=paste("/MAE323m",i,sep=""),dir.Rdata,paste("Hito 2s",i,sep=""))}
Rdata_perfils1<-here(dir.Rdata,"PerfilVero_Hito 2s1.RData")
Rdata_perfils2<-here(dir.Rdata,"PerfilVero_Hito 2s2.RData")
Rdata_perfils3<-here(dir.Rdata,"PerfilVero_Hito 2s3.RData")
p1<-fig12(Rdata_perfils1,"Hito 2: S1",c(30000, 210000))
p2<-fig12(Rdata_perfils2,"Hito 2: S2",c(30000, 210000))
p3<-fig12(Rdata_perfils3,"Hito 2: S3",c(30000, 210000))
ggarrange(p1,p2,p3, ncol=2, nrow=2, common.legend= TRUE, legend= "right")
Rdata_perfils1<-here(dir.Rdata,"PerfilVero_Hito 2s1.RData")
Rdata_perfils4<-here(dir.Rdata,"PerfilVero_Hito 2s4.RData")
Rdata_perfils5<-here(dir.Rdata,"PerfilVero_Hito 2s5.RData")
Rdata_perfils6<-here(dir.Rdata,"PerfilVero_Hito 2s6.RData")
p1<-fig12(Rdata_perfils1,"Hito 2: S1",c(30000, 210000))
p2<-fig12(Rdata_perfils4,"Hito 2: S4",c(30000, 210000))
p3<-fig12(Rdata_perfils5,"Hito 2: S5",c(30000, 210000))
p4<-fig12(Rdata_perfils6,"Hito 2: S6",c(30000, 210000))
ggarrange(p1,p2,p3,p4, ncol=2, nrow=2, common.legend= TRUE, legend= "right")
Rdata_perfils1<-here(dir.Rdata,"PerfilVero_Hito 2s1.RData")
Rdata_perfils7<-here(dir.Rdata,"PerfilVero_Hito 2s7.RData")
Rdata_perfils8<-here(dir.Rdata,"PerfilVero_Hito 2s8.RData")
Rdata_perfils9<-here(dir.Rdata,"PerfilVero_Hito 2s9.RData")
p1<-fig12(Rdata_perfils1,"Hito 2: S1",c(30000, 210000))
p2<-fig12(Rdata_perfils7,"Hito 2: S7",c(30000, 210000))
p3<-fig12(Rdata_perfils8,"Hito 2: S8",c(30000, 210000))
p4<-fig12(Rdata_perfils9,"Hito 2: S9",c(30000, 210000))
ggarrange(p1,p2,p3,p4, ncol=2, nrow=2, common.legend= TRUE, legend= "right")
## Cargar funciones
source(here(dir.fun,"functions.R"))
source(here(dir.fun,"Fn_CrearRdata.R"))
source(here(dir.fun,"Fn_Data.frame.R"))
source(here(dir.fun,"Fn_Figuras.R"))
source(here(dir.fun,"Fn_Tablas.R"))
source(here(dir.fun,"Fn_PBRs.R"))
source(here(dir.fun,"removefile.R"))
Rdata_perfils1<-here(dir.Rdata,"PerfilVero_Hito 2s1.RData")
Rdata_perfils2<-here(dir.Rdata,"PerfilVero_Hito 2s2.RData")
Rdata_perfils3<-here(dir.Rdata,"PerfilVero_Hito 2s3.RData")
p1<-fig12.1(Rdata_perfils1,"Hito 2: S1",c(30000, 210000))
p2<-fig12.1(Rdata_perfils2,"Hito 2: S2",c(30000, 210000))
p3<-fig12.1(Rdata_perfils3,"Hito 2: S3",c(30000, 210000))
ggarrange(p1,p2,p3, ncol=2, nrow=2, common.legend= TRUE, legend= "right")
mpdhplot    <-mpdh_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="1. Crucero de huevos",observado=mpdh_obs)%>%melt(id=c("years","index"))
reclasplot  <-reclas_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="2. Crucero de verano",observado=reclas_obs)%>%melt(id=c("years","index"))
pelacesplot <-pelaces_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="3. Crucero de oto침o",observado=pelaces_obs)%>%melt(id=c("years","index"))
Ajustes1<-rbind(mpdhplot,reclasplot,pelacesplot)
#----------------------------------------------------------------------
labelsplot<-c("caso base","dt_mph variable","dt_mph variable y 3 bloques_qmph","Observado")
colorplot<-c("black","red","green","gray")
shapeplot<-c(rep(19,3),21)
linetypeplot<-c(rep("solid",3),"dashed")
tittleleg<-"Escenarios"
#----------------------------------------------------------------------
p1.s1<-ggplot(Ajustes1,aes(x=years,y=value/1000000,color=variable))+
geom_line(aes(linetype=variable))+
geom_point(aes(shape=variable),size=2.5)+xlim(2000,2024)+
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
scale_shape_manual(name=tittleleg,labels=labelsplot,values=shapeplot)+
scale_linetype_manual(name=tittleleg,labels=labelsplot,values=linetypeplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_y") +
ylab("mpdh")+xlab("")+theme_bw()
p1.s1
#----------------------------------------------------------------------
#ggarrange(p1,p2,p3,ncol=1,common.legend = T)
#----------------------------------------------------------------------
# MPDH
mpdh_pred_res<-log(mpdh_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(mpdh_pred_res)[3]<-"Pred"
mpdh_res<-resmph[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(mpdh_res)[3]<-"Res"
ResMPH<-merge(mpdh_pred_res,mpdh_res) %>% mutate(index="1. Crucero de huevos")
#RECLAS
recl_pred_res<-log(reclas_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(recl_pred_res)[3]<-"Pred"
recl_res<-resrecl[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(recl_res)[3]<-"Res"
ResRECL<-merge(recl_pred_res,recl_res)%>% mutate(index="2. Crucero de verano")
#PELACES
pela_pred_res<-log(pelaces_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(pela_pred_res)[3]<-"Pred"
pela_res<-respela[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(pela_res)[3]<-"Res"
ResPELA<-merge(pela_pred_res,pela_res)%>% mutate(index="3. Crucero de oto침o")
#BASEDATOS
RESIDUOS<-rbind(ResMPH,ResRECL,ResPELA)
#----------------------------------------------------------------------
labelsplot<-c("caso base","dt_mph variable","dt_mph variable y 3 bloques_qmph")
colorplot<-c("black","red","green")
tittleleg<-"Escenarios"
#----------------------------------------------------------------------
#PLOT
r1.1  <-ggplot(RESIDUOS, aes(yrs,Res,fill=variable)) + xlim(2000,2024)+
geom_smooth(aes(fill=variable,color=variable),alpha=.1)+
geom_bar(stat='identity', position='dodge') +
geom_hline(yintercept = 0) +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
scale_fill_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'A침o', y = 'Residuales (escala log)') +
theme_bw(base_size=9.5)
r2.2  <-ggplot(RESIDUOS, aes(Pred,Res,color=variable)) +
geom_smooth(aes(fill=variable,color=variable),alpha=.1)+
geom_point(size = 1.5) +
geom_hline(yintercept = 0) +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Predicho (log)', y = 'Residuales') +
theme_bw(base_size=9.5)
r4.4 <- ggplot(RESIDUOS, aes(sample = Res,color=variable)) +
stat_qq() +
stat_qq_line() +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Sample Quantiles', y ='Theoretical') +
theme_bw(base_size=9.5)
#-------------------------------------------------------------
ggarrange(r1.1,r2.2,r4.4,ncol=3,common.legend = T)
#-------------------------------------------------------------
ggarrange(p1.s1,r1.1,ncol=3,common.legend = T)
ggarrange(p1.s1,r1.1,ncol=2,common.legend = T)
# MPDH
mpdh_pred_res<-log(mpdh_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(mpdh_pred_res)[3]<-"Pred"
mpdh_res<-resmph[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(mpdh_res)[3]<-"Res"
ResMPH<-merge(mpdh_pred_res,mpdh_res) %>% mutate(index="1. Crucero de huevos")
#RECLAS
recl_pred_res<-log(reclas_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(recl_pred_res)[3]<-"Pred"
recl_res<-resrecl[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(recl_res)[3]<-"Res"
ResRECL<-merge(recl_pred_res,recl_res)%>% mutate(index="2. Crucero de verano")
#PELACES
pela_pred_res<-log(pelaces_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(pela_pred_res)[3]<-"Pred"
pela_res<-respela[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(pela_res)[3]<-"Res"
ResPELA<-merge(pela_pred_res,pela_res)%>% mutate(index="3. Crucero de oto침o")
#BASEDATOS
RESIDUOS<-rbind(ResMPH,ResRECL,ResPELA)
#----------------------------------------------------------------------
labelsplot<-c("caso base","dt_mph variable","dt_mph variable y 3 bloques_qmph")
colorplot<-c("black","red","green")
tittleleg<-"Escenarios"
#----------------------------------------------------------------------
#PLOT
r1.1  <-ggplot(RESIDUOS, aes(yrs,Res,fill=variable)) + xlim(2000,2024)+
geom_smooth(aes(fill=variable,color=variable),alpha=.1)+
geom_bar(stat='identity', position='dodge') +
geom_hline(yintercept = 0) +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
scale_fill_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_y") +
labs(x= 'A침o', y = 'Residuales (escala log)') +
theme_bw(base_size=9.5)
r2.2  <-ggplot(RESIDUOS, aes(Pred,Res,color=variable)) +
geom_smooth(aes(fill=variable,color=variable),alpha=.1)+
geom_point(size = 1.5) +
geom_hline(yintercept = 0) +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Predicho (log)', y = 'Residuales') +
theme_bw(base_size=9.5)
r4.4 <- ggplot(RESIDUOS, aes(sample = Res,color=variable)) +
stat_qq() +
stat_qq_line() +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Sample Quantiles', y ='Theoretical') +
theme_bw(base_size=9.5)
#-------------------------------------------------------------
ggarrange(r1.1,r2.2,r4.4,ncol=3,common.legend = T)
#-------------------------------------------------------------
ggarrange(p1.s1,r1.1,ncol=2,common.legend = T)
mpdhplot    <-mpdh_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="1. Crucero de huevos",observado=mpdh_obs)%>%melt(id=c("years","index"))
reclasplot  <-reclas_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="2. Crucero de verano",observado=reclas_obs)%>%melt(id=c("years","index"))
pelacesplot <-pelaces_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="3. Crucero de oto침o",observado=pelaces_obs)%>%melt(id=c("years","index"))
Ajustes1<-rbind(mpdhplot,reclasplot,pelacesplot)
#----------------------------------------------------------------------
labelsplot<-c("caso base","dt_mph variable","dt_mph variable y 3 bloques_qmph","Observado")
colorplot<-c("black","red","green","gray")
shapeplot<-c(rep(19,3),21)
linetypeplot<-c(rep("solid",3),"dashed")
tittleleg<-"Escenarios"
#----------------------------------------------------------------------
p1.s1<-ggplot(Ajustes1,aes(x=years,y=value/1000000,color=variable))+
geom_line(aes(linetype=variable))+
geom_point(aes(shape=variable),size=2.5)+xlim(2000,2024)+
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
scale_shape_manual(name=tittleleg,labels=labelsplot,values=shapeplot)+
scale_linetype_manual(name=tittleleg,labels=labelsplot,values=linetypeplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_y") +
ylab("Biomasa (millones de t")+xlab("")+theme_bw()
p1.s1
#----------------------------------------------------------------------
#ggarrange(p1,p2,p3,ncol=1,common.legend = T)
#----------------------------------------------------------------------
ggarrange(p1.s1,r1.1,ncol=2,common.legend = T)
ggarrange(p1.s1,r1.1,ncol=2,common.legend = T)
Rdata_perfils1<-here(dir.Rdata,"PerfilVero_Hito 2s1.RData")
Rdata_perfils2<-here(dir.Rdata,"PerfilVero_Hito 2s2.RData")
Rdata_perfils3<-here(dir.Rdata,"PerfilVero_Hito 2s3.RData")
p1<-fig12.1(Rdata_perfils1,"S1: Caso base",c(30000, 210000))
p2<-fig12.1(Rdata_perfils2,"S2: dt_mph variable",c(30000, 210000))
p3<-fig12.1(Rdata_perfils3,"S3: dt_mph variable y 3 bloques_qmph",c(30000, 210000))
ggarrange(p1,p2,p3, ncol=2, nrow=2, common.legend= TRUE, legend= "right")
ggarrange(p1.s1,r1.1,ncol=2,common.legend = T)+
theme(plot.title=element_text(size=10),legend.text=element_text(size=6))
nesc<-9
#indicadores
nyears<-dat1$nanos
years<-dat1$Ind[,1]
mpdh_obs<-dat1$Ind[,6];mpdh_obs[mpdh_obs==0]<-NA
reclas_obs<-dat1$Ind[,2];reclas_obs[reclas_obs==0]<-NA
pelaces_obs<-dat1$Ind[,4];pelaces_obs[pelaces_obs==0]<-NA
mpdh_pred<-matrix(nrow=nyears,ncol=nesc)
reclas_pred<-matrix(nrow=nyears,ncol=nesc)
pelaces_pred<-matrix(nrow=nyears,ncol=nesc)
resmph <-matrix(nrow=nyears,ncol=nesc)
resrecl<-matrix(nrow=nyears,ncol=nesc)
respela<-matrix(nrow=nyears,ncol=nesc)
BD<-matrix(nrow=nyears,ncol=nesc)
Rt<-matrix(nrow=nyears,ncol=nesc)
Ft<-matrix(nrow=nyears,ncol=nesc)
escenarios<-rep(0,nesc)
for(i in 1:nesc){
rep1.1<- reptoRlist(paste(here(NombrecarpetaEsc),"/MAE323m",i,".rep",sep=""))
mpdh_pred[,i]<- rep1.1$mphpred
reclas_pred[,i]<-rep1.1$reclaspred
pelaces_pred[,i]<-rep1.1$pelacespred
resmph[,i] <-(log(mpdh_pred[,i])-log(mpdh_obs))
resrecl[,i]<-(log(reclas_pred[,i])-log(reclas_obs))
respela[,i]<-(log(pelaces_pred[,i])-log(pelaces_obs))
BD[,i]<-rep1.1$SSB
Rt[,i]<-rep1.1$Reclutas
Ft[,i]<-rep1.1$Ftot
escenarios[i]<-paste("S",i,sep="")
}
colnames(mpdh_pred)<-escenarios
colnames(reclas_pred)<-escenarios
colnames(pelaces_pred)<-escenarios
colnames(resmph)<-escenarios
colnames(resrecl)<-escenarios
colnames(respela)<-escenarios
colnames(BD)<-escenarios
colnames(Rt)<-escenarios
colnames(Ft)<-escenarios
mpdhplot    <-mpdh_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="1. Crucero de huevos",observado=mpdh_obs)%>%melt(id=c("years","index"))
reclasplot  <-reclas_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="2. Crucero de verano",observado=reclas_obs)%>%melt(id=c("years","index"))
pelacesplot <-pelaces_pred[,1:3]%>%data.frame()%>%
mutate(years=years,index="3. Crucero de oto침o",observado=pelaces_obs)%>%melt(id=c("years","index"))
Ajustes1<-rbind(mpdhplot,reclasplot,pelacesplot)
#----------------------------------------------------------------------
labelsplot<-c("caso base","dt_mph variable","dt_mph variable y 3 bloques_qmph","Observado")
colorplot<-c("black","red","green","gray")
shapeplot<-c(rep(19,3),21)
linetypeplot<-c(rep("solid",3),"dashed")
tittleleg<-"Escenarios"
#----------------------------------------------------------------------
p1.s1<-ggplot(Ajustes1,aes(x=years,y=value/1000000,color=variable))+
geom_line(aes(linetype=variable))+
geom_point(aes(shape=variable),size=2.5)+xlim(2000,2024)+
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
scale_shape_manual(name=tittleleg,labels=labelsplot,values=shapeplot)+
scale_linetype_manual(name=tittleleg,labels=labelsplot,values=linetypeplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_y") +
ylab("Biomasa (millones de t)")+xlab("")+theme_bw()
#p1.s1
#----------------------------------------------------------------------
#ggarrange(p1,p2,p3,ncol=1,common.legend = T)
#----------------------------------------------------------------------
# MPDH
mpdh_pred_res<-log(mpdh_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(mpdh_pred_res)[3]<-"Pred"
mpdh_res<-resmph[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(mpdh_res)[3]<-"Res"
ResMPH<-merge(mpdh_pred_res,mpdh_res) %>% mutate(index="1. Crucero de huevos")
#RECLAS
recl_pred_res<-log(reclas_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(recl_pred_res)[3]<-"Pred"
recl_res<-resrecl[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(recl_res)[3]<-"Res"
ResRECL<-merge(recl_pred_res,recl_res)%>% mutate(index="2. Crucero de verano")
#PELACES
pela_pred_res<-log(pelaces_pred)[,1:3] %>% data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(pela_pred_res)[3]<-"Pred"
pela_res<-respela[,1:3]%>%data.frame() %>% mutate(yrs=years) %>% melt(id="yrs");names(pela_res)[3]<-"Res"
ResPELA<-merge(pela_pred_res,pela_res)%>% mutate(index="3. Crucero de oto침o")
#BASEDATOS
RESIDUOS<-rbind(ResMPH,ResRECL,ResPELA)
#----------------------------------------------------------------------
labelsplot<-c("caso base","dt_mph variable","dt_mph variable y 3 bloques_qmph")
colorplot<-c("black","red","green")
tittleleg<-"Escenarios"
#----------------------------------------------------------------------
#PLOT
r1.1  <-ggplot(RESIDUOS, aes(yrs,Res,fill=variable)) + xlim(2000,2024)+
geom_smooth(aes(fill=variable,color=variable),alpha=.1)+
geom_bar(stat='identity', position='dodge') +
geom_hline(yintercept = 0) +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
scale_fill_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_y") +
labs(x= 'A침o', y = 'Residuales (escala log)') +
theme_bw(base_size=9.5)
r2.2  <-ggplot(RESIDUOS, aes(Pred,Res,color=variable)) +
geom_smooth(aes(fill=variable,color=variable),alpha=.1)+
geom_point(size = 1.5) +
geom_hline(yintercept = 0) +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Predicho (log)', y = 'Residuales') +
theme_bw(base_size=9.5)
r4.4 <- ggplot(RESIDUOS, aes(sample = Res,color=variable)) +
stat_qq() +
stat_qq_line() +
scale_color_manual(name=tittleleg,labels=labelsplot,values=colorplot)+
facet_wrap(. ~ index, ncol = 1,scales = "free_x") +
labs(x= 'Sample Quantiles', y ='Theoretical') +
theme_bw(base_size=9.5)
#-------------------------------------------------------------
#ggarrange(r1.1,r2.2,r4.4,ncol=3,common.legend = T)
#-------------------------------------------------------------
ggarrange(p1.s1,r1.1,ncol=2,common.legend = T)+
theme(plot.title=element_text(size=10),legend.text=element_text(size=6))
resmph
resmph[,1]^2
sum(resmph[,1]^2)
sum((resmph[,1]^2),na.rm=TRUE)
sum((resmph[,1]^2),na.rm=TRUE)/18
sqrt(sum((resmph[,1]^2),na.rm=TRUE)/18)
length(resmph[,1],na.rm=TRUE)
length(resmph[,1])
resmph[,1]
RMSE_mph<-rep(0,nesc)
for(i in 1:nesc){
RMSE_mph[i]<-sqrt(sum((resmph[,i]^2),na.rm=TRUE)/18)}
RMSE_mph
resrecl
respela
RMSE_mph<-rep(0,nesc)
RMSE_reclas<-rep(0,nesc)
RMSE_pelaces<-rep(0,nesc)
for(i in 1:nesc){
RMSE_mph[i]<-sqrt(sum((resmph[,i]^2),na.rm=TRUE)/18)
RMSE_reclas[i]<-sqrt(sum((resrecl[,i]^2),na.rm=TRUE)/23)
RMSE_pelaces[i]<-sqrt(sum((respela[,i]^2),na.rm=TRUE)/15)
}
RMSE_pelaces
RMSE_reclas
RMSE_mph<-rep(0,nesc)
RMSE_reclas<-rep(0,nesc)
RMSE_pelaces<-rep(0,nesc)
for(i in 1:nesc){
RMSE_mph[i]<-round(sqrt(sum((resmph[,i]^2),na.rm=TRUE)/18),2)
RMSE_reclas[i]<-round(sqrt(sum((resrecl[,i]^2),na.rm=TRUE)/23),2)
RMSE_pelaces[i]<-round(sqrt(sum((respela[,i]^2),na.rm=TRUE)/15),2)
}
RMSE_pelaces
RMSE_reclas
RMSE_mph
nesc<-9
#indicadores
nyears<-dat1$nanos
years<-dat1$Ind[,1]
mpdh_obs<-dat1$Ind[,6];mpdh_obs[mpdh_obs==0]<-NA
reclas_obs<-dat1$Ind[,2];reclas_obs[reclas_obs==0]<-NA
pelaces_obs<-dat1$Ind[,4];pelaces_obs[pelaces_obs==0]<-NA
mpdh_pred<-matrix(nrow=nyears,ncol=nesc)
reclas_pred<-matrix(nrow=nyears,ncol=nesc)
pelaces_pred<-matrix(nrow=nyears,ncol=nesc)
resmph <-matrix(nrow=nyears,ncol=nesc)
resrecl<-matrix(nrow=nyears,ncol=nesc)
respela<-matrix(nrow=nyears,ncol=nesc)
RMSE_mph<-rep(0,nesc)
RMSE_reclas<-rep(0,nesc)
RMSE_pelaces<-rep(0,nesc)
BD<-matrix(nrow=nyears,ncol=nesc)
Rt<-matrix(nrow=nyears,ncol=nesc)
Ft<-matrix(nrow=nyears,ncol=nesc)
escenarios<-rep(0,nesc)
for(i in 1:nesc){
rep1.1<- reptoRlist(paste(here(NombrecarpetaEsc),"/MAE323m",i,".rep",sep=""))
mpdh_pred[,i]<- rep1.1$mphpred
reclas_pred[,i]<-rep1.1$reclaspred
pelaces_pred[,i]<-rep1.1$pelacespred
resmph[,i] <-(log(mpdh_pred[,i])-log(mpdh_obs))
resrecl[,i]<-(log(reclas_pred[,i])-log(reclas_obs))
respela[,i]<-(log(pelaces_pred[,i])-log(pelaces_obs))
RMSE_mph[i]<-round(sqrt(sum((resmph[,i]^2),na.rm=TRUE)/18),2)
RMSE_reclas[i]<-round(sqrt(sum((resrecl[,i]^2),na.rm=TRUE)/23),2)
RMSE_pelaces[i]<-round(sqrt(sum((respela[,i]^2),na.rm=TRUE)/15),2)
BD[,i]<-rep1.1$SSB
Rt[,i]<-rep1.1$Reclutas
Ft[,i]<-rep1.1$Ftot
escenarios[i]<-paste("S",i,sep="")
}
colnames(mpdh_pred)<-escenarios
colnames(reclas_pred)<-escenarios
colnames(pelaces_pred)<-escenarios
colnames(resmph)<-escenarios
colnames(resrecl)<-escenarios
colnames(respela)<-escenarios
colnames(BD)<-escenarios
colnames(Rt)<-escenarios
colnames(Ft)<-escenarios
